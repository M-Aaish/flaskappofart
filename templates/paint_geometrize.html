{% extends "base.html" %}

{% block extra_head %}
  <!-- inline styles – no external CSS imports -->
  <style>
    /* ───────────────────────────────
       BASIC LAYOUT & BUTTONS
    ─────────────────────────────── */
    body { margin: 0; font-family: system-ui, sans-serif; }
    .button {
      background: #e91e63;
      color: #fff;
      border: none;
      padding: 8px 14px;
      margin: 4px;
      border-radius: 4px;
      cursor: pointer;
      font-size: .9em;
    }
    .button:hover { background: #d81b60; }

    /* hide the entire settings accordion by default */
    #accordion { display: none; }

    /* force sliders into one line with scroll */
    .sliders.single-line {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
    }
    .sliders.single-line .slider-group {
      flex: 0 0 200px;
      margin-right: 16px;
    }

    /* style for native range inputs */
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      background: #ddd;
      border-radius: 3px;
      margin: 8px 0;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #e91e63;
      border: 2px solid #fff;
      border-radius: 50%;
      cursor: pointer;
    }

    /* ───────────────────────────────
       TOGGLES INLINE
    ─────────────────────────────── */
    .toggles {
      display: flex;          /* force one horizontal row */
      flex-wrap: nowrap;      /* no wrapping */
      align-items: center;
      gap: 16px;
      overflow-x: auto;
      padding: 0;
      margin: 8px 0;
    }
    .toggles label {
      display: flex;
      align-items: center;
      white-space: nowrap;
      flex-shrink: 0;
      margin: 0;              /* override any default */
    }
    .toggles input[type="checkbox"] {
      margin-right: 4px;
    }

    /* off-screen file input (so click() still works) */
    #openimageinput {
      position: absolute;
      left: -9999px;
    }
  </style>
{% endblock %}

{% block content %}
  <!-- HEADER -->
  <section id="header">
    <h1 style="font-size: 3em; color: #e91e63; animation: glow 2s ease-in-out infinite alternate;">
      🎨 geometrize
    </h1>
  </section>

  <!-- SETTINGS ACCORDION -->
  <section id="accordion">
    <input id="check-1" type="checkbox"/>
    <label for="check-1" class="button">⚙️ Settings</label>
    <div class="settings">
      <!-- SLIDERS -->
      <div class="sliders single-line">
        <div class="slider-group">
          <label>🎛️ Shape Opacity:
            <input
              type="range"
              id="shapeopacity"
              name="shapeopacity"
              min="1"
              max="255"
              value="128"
              oninput="shapeopacity_label.innerText = this.value;"
            >
            <span id="shapeopacity_label">128</span>
          </label>
        </div>
        <div class="slider-group">
          <label>🌄 Background Opacity:
            <input
              type="range"
              id="initialbackgroundopacity"
              name="initialbackgroundopacity"
              min="1"
              max="255"
              value="128"
              oninput="backgroundopacity_label.innerText = this.value;"
            >
            <span id="backgroundopacity_label">128</span>
          </label>
        </div>
        <div class="slider-group">
          <label>🎲 Random Shapes:
            <input
              type="range"
              id="randomshapesperstep"
              name="randomshapesperstep"
              min="1"
              max="100"
              value="10"
              oninput="randomshapes_label.innerText = this.value;"
            >
            <span id="randomshapes_label">10</span>
          </label>
        </div>
        <div class="slider-group">
          <label>🔁 Mutations:
            <input
              type="range"
              id="shapemutationsperstep"
              name="shapemutationsperstep"
              min="1"
              max="100"
              value="10"
              oninput="mutations_label.innerText = this.value;"
            >
            <span id="mutations_label">10</span>
          </label>
        </div>
      </div>

      <!-- TOGGLES (now truly inline) -->
      <div class="toggles">
        <label><input type="checkbox" id="rectangles"/> ▭ Rectangles</label>
        <label><input type="checkbox" id="rotatedrectangles"/> ↻ Rotated Rectangles</label>
        <label><input type="checkbox" id="triangles"/> 🔺 Triangles</label>
        <label><input type="checkbox" id="ellipses"/> 🥚 Ellipses</label>
        <label><input type="checkbox" id="rotatedellipses"/> ↻ Rotated Ellipses</label>
        <label><input type="checkbox" id="circles"/> ⚪ Circles</label>
        <label><input type="checkbox" id="lines"/> ➖ Lines</label>
        <label><input type="checkbox" id="quadraticbeziers"/> 🌀 Bezier Curves</label>
      </div>

      <!-- COUNTERS & LIMITS -->
      <div class="limits">
        <label>➕ Shapes Added: <span id="shapesaddedtext">0</span></label>
        <label>🚧 Max Shapes Limit:
          <input type="number" id="maxshapescaptextedit" min="20" step="1"/>
        </label>
      </div>
    </div>
  </section>

  <!-- SVG CANVAS -->
  <div id="currentsvgcontainer"></div>

  <!-- CONTROLS -->
  <div id="controls">
    <input type="file" id="openimageinput" accept="image/*"/>
    <button id="openimagebutton" class="button" onclick="openImage()">📂 Open Image</button>
    <button id="settings-toggle" class="button">⚙️ Settings</button>
    <button id="resetbutton" class="button">🔄 Reset</button>
    <button id="runpausebutton" class="button">🟢 Run</button>
    <button id="stepbutton" class="button">⏭️ Step</button>
  </div>

  <!-- SAVE OPTIONS -->
  <div id="saveoptions">
    <button id="saveimagebutton" class="button">💾 Save Image</button>
    <button id="savesvgbutton" class="button">📐 Save SVG</button>
    <button id="savejsonbutton" class="button">📄 Save JSON</button>
  </div>

  <!-- HOW IT WORKS -->
  <section>
    <h2>🚀 How It Works</h2>
    <p>🧠 GeoMagic turns your uploaded images into abstract art by evolving colorful shapes over time.</p>
    <p>🎨 Watch triangles, ellipses, and curves blend into expressive visuals — like origami for pixels!</p>
    <p>▶️ Click <strong>Run</strong> to begin. Save your creation as PNG, SVG, or JSON when you're ready.</p>
    <p>📚 Explore documentation or join our creative community for tips and inspiration!</p>
  </section>
{% endblock %}

{% block extra_js %}
  <script>
    function openImage() {
      document.getElementById('openimageinput').click();
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('settings-toggle')
        .addEventListener('click', () => {
          const acc = document.getElementById('accordion');
          acc.style.display = acc.style.display === 'block' ? 'none' : 'block';
        });
      document.getElementById('resetbutton').addEventListener('click', () => {
        document.querySelectorAll('#currentsvgcontainer img, #currentsvgcontainer svg')
                .forEach(el => el.remove());
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.querySelectorAll('input[type="range"]').forEach(slider => {
          const def = slider.getAttribute('value') || slider.min || 0;
          slider.value = def;
          const lbl = document.getElementById(`${slider.id}_label`);
          if (lbl) lbl.textContent = def;
        });
        const shapesAdded = document.getElementById('shapesaddedtext');
        if (shapesAdded) shapesAdded.textContent = '0';
      });
    });
  </script>

  <!-- JS libraries -->
  <script src="{{ url_for('static', filename='js/wNumb.min.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/nouislider.min.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/geometrize.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/ui_bridge.js') }}"></script>
{% endblock %}
