{# ──────────────────────────────────────────────────────────────────────────── #}
{#  templates/geometrize.html                                                  #}
{# ──────────────────────────────────────────────────────────────────────────── #}
{% extends "base.html" %}

{% block title %}🎨 Geometrize{% endblock %}

{% block content %}
  {# ────────────── INLINE STYLE PATCH ────────────── #}
  <style>
    /* 1. Centre the palette-emoji + “geometrize” heading */
    #header{
      display:flex;
      justify-content:center;      /* horizontal centring */
      align-items:center;          /* vertical alignment of emoji vs text */
      margin:2rem 0 1.5rem;        /* breathing room */
    }
    #header h1{ margin:0; }        /* remove default h1 margins */

    /* 2. Lay out buttons in tidy, wrapping rows */
    #controls,
    #saveoptions{
      display:flex;
      flex-wrap:wrap;              /* push overflow items onto next line */
      gap:0.75rem;                 /* equal spacing between buttons */
      justify-content:center;      /* centre the whole group */
    }

    /* 2a. Extra breathing room **between** the two rows */
    #controls{ margin-bottom:1rem; }  /* <<— NEW */

    /* 3. Uniform button styling */
    .button{
      padding:0.8rem 1.4rem;
      font-size:1rem;
      border:0;
      border-radius:0.5rem;
      cursor:pointer;
      white-space:nowrap;          /* keep icon + label together */
    }
  </style>

  {# ────────────── HEADER ────────────── #}
  <section id="header">
    <h1 style="font-size:3em; color:#e91e63; animation: glow 2s ease-in-out infinite alternate;">
      🎨 geometrize
    </h1>
  </section>

  {# ────────────── SVG CANVAS (renders the evolving artwork) ────────────── #}
  <div id="currentsvgcontainer"></div>

  {# ────────────── CONTROLS ────────────── #}
  <div id="controls">
    <!-- hidden native file-picker input -->
    <input type="file"
           id="openimageinput"
           accept="image/*"
           hidden>

    <!-- visible buttons -->
    <button id="openimagebutton" class="button" onclick="openImage()">📂 Open Image</button>
    <button id="settings-toggle" class="button">⚙️ Settings</button>
    <button id="resetbutton"     class="button">🔄 Reset</button>
    <button id="runpausebutton"  class="button">🟢 Run</button>
    <button id="stepbutton"      class="button">⏭️ Step</button>
  </div>

  {# ────────────── SETTINGS ACCORDION (initially hidden) ────────────── #}
  <section id="accordion" style="display:none;">
    <div class="settings">
      <!-- SLIDERS -->
      <div class="sliders single-line">
        <div class="slider-group">
          <label>🎛️ Shape Opacity:
            <input type="range" id="shapeopacity" name="shapeopacity"
                   min="1" max="255" value="128"
                   oninput="shapeopacity_label.innerText = this.value;">
            <span id="shapeopacity_label">128</span>
          </label>
        </div>
        <div class="slider-group">
          <label>🌄 Background Opacity:
            <input type="range" id="initialbackgroundopacity" name="initialbackgroundopacity"
                   min="1" max="255" value="128"
                   oninput="backgroundopacity_label.innerText = this.value;">
            <span id="backgroundopacity_label">128</span>
          </label>
        </div>
        <div class="slider-group">
          <label>🎲 Random Shapes:
            <input type="range" id="randomshapesperstep" name="randomshapesperstep"
                   min="1" max="100" value="10"
                   oninput="randomshapes_label.innerText = this.value;">
            <span id="randomshapes_label">10</span>
          </label>
        </div>
        <div class="slider-group">
          <label>🔁 Mutations:
            <input type="range" id="shapemutationsperstep" name="shapemutationsperstep"
                   min="1" max="100" value="10"
                   oninput="mutations_label.innerText = this.value;">
            <span id="mutations_label">10</span>
          </label>
        </div>
      </div>

      <!-- TOGGLES -->
      <div class="toggles">
        <div class="toggle"><label for="rectangles">▭ Rectangles</label>           <input type="checkbox" id="rectangles"/></div>
        <div class="toggle"><label for="rotatedrectangles">↻ Rotated Rectangles</label><input type="checkbox" id="rotatedrectangles"/></div>
        <div class="toggle"><label for="triangles">🔺 Triangles</label>            <input type="checkbox" id="triangles"/></div>
        <div class="toggle"><label for="ellipses">🥚 Ellipses</label>              <input type="checkbox" id="ellipses"/></div>
        <div class="toggle"><label for="rotatedellipses">↻ Rotated Ellipses</label><input type="checkbox" id="rotatedellipses"/></div>
        <div class="toggle"><label for="circles">⚪ Circles</label>                <input type="checkbox" id="circles"/></div>
        <div class="toggle"><label for="lines">➖ Lines</label>                    <input type="checkbox" id="lines"/></div>
        <div class="toggle"><label for="quadraticbeziers">🌀 Bezier Curves</label> <input type="checkbox" id="quadraticbeziers"/></div>
      </div>
      
      <!-- COUNTERS & LIMITS -->
      <div class="limits">
        <label>➕ Shapes Added: <span id="shapesaddedtext">0</span></label>
        <label>🚧 Max Shapes Limit:
          <input type="number" id="maxshapescaptextedit" min="20" step="1"/>
        </label>
      </div>
    </div>
  </section>

  {# ────────────── SAVE OPTIONS ────────────── #}
  <div id="saveoptions">
    <button id="saveimagebutton" class="button">💾 Save Image</button>
    <button id="savesvgbutton"   class="button">📐 Save SVG</button>
    <button id="savejsonbutton"  class="button">📄 Save JSON</button>
  </div>

  {# ────────────── HOW IT WORKS ────────────── #}
  <section>
    <h2>🚀 How It Works</h2>
    <p>🧠 <strong>GeoMagic</strong> turns your uploaded images into abstract art by evolving colourful shapes over time.</p>
    <p>🎨 Watch triangles, ellipses, and curves blend into expressive visuals — like origami for pixels!</p>
    <p>▶️ Click <strong>Run</strong> to begin. Save your creation as PNG, SVG, or JSON when you're ready.</p>
    <p>📚 Explore documentation or join our creative community for tips and inspiration!</p>
  </section>
{% endblock %}

{% block extra_js %}
  <script>
    /* open file-picker via hidden input */
    function openImage() {
      document.getElementById('openimageinput').click();
    }

    document.addEventListener('DOMContentLoaded', () => {
      /* accordion toggle */
      document.getElementById('settings-toggle').addEventListener('click', () => {
        const acc = document.getElementById('accordion');
        acc.style.display = (acc.style.display === 'none' || acc.style.display === '') ? 'block' : 'none';
        if (acc.style.display === 'block') acc.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });

      /* reset logic */
      document.getElementById('resetbutton').addEventListener('click', () => {
        /* clear canvas */
        document.querySelectorAll('#currentsvgcontainer img, #currentsvgcontainer svg')
                .forEach(el => el.remove());

        /* reset checkboxes */
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);

        /* reset sliders + labels */
        document.querySelectorAll('input[type="range"]').forEach(slider => {
          const def = slider.getAttribute('value') || slider.min || 0;
          slider.value = def;
          const lbl = document.getElementById(`${slider.id}_label`);
          if (lbl) lbl.textContent = def;
        });

        /* reset shapes-added counter */
        document.getElementById('shapesaddedtext').textContent = '0';
      });
    });
  </script>

  <!-- external bundles -->
  <script src="{{ url_for('static', filename='js/wNumb.min.js') }}"    defer></script>
  <script src="{{ url_for('static', filename='js/nouislider.min.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/geometrize.js') }}"    defer></script>
  <script src="{{ url_for('static', filename='js/ui_bridge.js') }}"></script>
{% endblock %}
